# ğŸ“Š REPORTS MODULE - Äáº¶C Táº¢ Ká»¸ THUáº¬T

## ğŸ“Œ Tá»”NG QUAN

ThÃªm 2 module bÃ¡o cÃ¡o má»›i vÃ o há»‡ thá»‘ng:
1. **Sales Report** - BÃ¡o cÃ¡o hoáº¡t Ä‘á»™ng cá»§a nhÃ¢n viÃªn Sales
2. **Consultant Report** - BÃ¡o cÃ¡o hoáº¡t Ä‘á»™ng cá»§a nhÃ¢n viÃªn TÆ° váº¥n

**LÆ°u Ã½ quan trá»ng vá» phÃ¢n quyá»n:**
- **Admin:** Xem Ä‘Æ°á»£c táº¥t cáº£ bÃ¡o cÃ¡o cá»§a má»i nhÃ¢n viÃªn
- **Sales:** Chá»‰ xem Ä‘Æ°á»£c bÃ¡o cÃ¡o cá»§a báº£n thÃ¢n
- **Consultant (TÆ° váº¥n):** Chá»‰ xem Ä‘Æ°á»£c bÃ¡o cÃ¡o cá»§a báº£n thÃ¢n

---

## ğŸ“ˆ MODULE 1: SALES REPORT

### 1.1 Má»¥c Ä‘Ã­ch
GiÃºp Sales vÃ  Admin theo dÃµi hiá»‡u suáº¥t hoáº¡t Ä‘á»™ng cá»§a nhÃ¢n viÃªn Sales, bao gá»“m sá»‘ lÆ°á»£ng nhÃ  tháº§u/khÃ¡ch hÃ ng Ä‘Ã£ gáº·p, sá»‘ dá»± Ã¡n tham gia theo thá»i gian.

### 1.2 CÃ¡c thÃ nh pháº§n hiá»ƒn thá»‹

#### A. Tháº» Thá»‘ng KÃª (Stats Cards)
| Tháº» | MÃ´ táº£ | MÃ u sáº¯c |
|-----|-------|---------|
| **Tá»•ng nhÃ  tháº§u Ä‘Ã£ gáº·p** | Äáº¿m sá»‘ lÆ°á»£ng nhÃ  tháº§u/khÃ¡ch hÃ ng mÃ  Sales Ä‘Ã£ tiáº¿p xÃºc (cÃ³ trong leads) | ğŸ”µ Xanh dÆ°Æ¡ng |
| **NhÃ  tháº§u má»›i thÃ¡ng nÃ y** | Sá»‘ lÆ°á»£ng nhÃ  tháº§u má»›i (first contact trong thÃ¡ng hiá»‡n táº¡i) | ğŸŸ¢ Xanh lÃ¡ |
| **Tá»•ng dá»± Ã¡n tham gia** | Sá»‘ dá»± Ã¡n mÃ  Sales cÃ³ lead Ä‘Æ°á»£c assign | ğŸŸ  Cam |

#### B. Biá»ƒu Ä‘á»“ theo Module Sales

##### B1. Biá»ƒu Ä‘á»“ Cá»™t - Sá»‘ lÆ°á»£ng dá»± Ã¡n tham gia theo thÃ¡ng
- **Loáº¡i:** Bar Chart (Vertical)
- **Trá»¥c X:** ThÃ¡ng (MM/YYYY)
- **Trá»¥c Y:** Sá»‘ lÆ°á»£ng dá»± Ã¡n
- **Bá»™ lá»c:** Dropdown chá»n nÄƒm (máº·c Ä‘á»‹nh nÄƒm hiá»‡n táº¡i)
- **MÃ u sáº¯c:** Gradient xanh dÆ°Æ¡ng

##### B2. Biá»ƒu Ä‘á»“ Cá»™t - Sá»‘ lÆ°á»£ng nhÃ  tháº§u má»›i Ä‘Ã£ gáº·p theo thÃ¡ng
- **Loáº¡i:** Bar Chart (Vertical)
- **Trá»¥c X:** ThÃ¡ng (MM/YYYY)
- **Trá»¥c Y:** Sá»‘ lÆ°á»£ng nhÃ  tháº§u má»›i
- **Äá»‹nh nghÄ©a nhÃ  tháº§u má»›i:** NhÃ  tháº§u cÃ³ lead Ä‘áº§u tiÃªn Ä‘Æ°á»£c táº¡o trong thÃ¡ng Ä‘Ã³
- **MÃ u sáº¯c:** Gradient xanh lÃ¡

#### C. Biá»ƒu Ä‘á»“ Chung (Ãp dá»¥ng cho cáº£ Sales & Consultant)

##### C1. Biá»ƒu Ä‘á»“ TrÃ²n (Pie/Donut Chart) - TÃ¬nh tráº¡ng dá»± Ã¡n
- **Loáº¡i:** Donut Chart
- **Hiá»ƒn thá»‹:** PhÃ¢n bá»• dá»± Ã¡n theo tráº¡ng thÃ¡i (Active / Won / Lost / Cancelled)
- **Sá»‘ tá»•ng á»Ÿ giá»¯a:** Tá»•ng sá»‘ dá»± Ã¡n tham gia
- **MÃ u sáº¯c:** 
  - ğŸ”µ Active: Xanh dÆ°Æ¡ng
  - ğŸŸ¢ Won: Xanh lÃ¡
  - ğŸ”´ Lost: Äá»
  - âš« Cancelled: XÃ¡m

##### C2. Biá»ƒu Ä‘á»“ Káº¿t há»£p Cá»™t + ÄÆ°á»ng (Bar + Line Chart) - Trend
- **Äiá»u kiá»‡n hiá»ƒn thá»‹:** Chá»‰ xuáº¥t hiá»‡n khi cÃ³ dá»¯ liá»‡u tá»« **â‰¥ 3 thÃ¡ng**
- **Loáº¡i:** Combo Chart (Bar + Line)
- **Trá»¥c X:** ThÃ¡ng (MM/YYYY)
- **Trá»¥c Y trÃ¡i (Cá»™t):** Sá»‘ lÆ°á»£ng dá»± Ã¡n má»›i tham gia
- **Trá»¥c Y pháº£i (ÄÆ°á»ng):** Tá»· lá»‡ tháº¯ng (Win Rate %)
- **Má»¥c Ä‘Ã­ch:** Theo dÃµi xu hÆ°á»›ng hiá»‡u suáº¥t theo thá»i gian

---

## ğŸ“ˆ MODULE 2: CONSULTANT REPORT (TÆ¯ Váº¤N)

### 2.1 Má»¥c Ä‘Ã­ch
GiÃºp TÆ° váº¥n vÃ  Admin theo dÃµi hiá»‡u suáº¥t hoáº¡t Ä‘á»™ng cá»§a nhÃ¢n viÃªn TÆ° váº¥n, bao gá»“m sá»‘ dá»± Ã¡n Ä‘Ã£ lÃ m, sá»‘ lÆ°á»£ng sáº£n pháº©m, vÃ  giÃ¡ trá»‹ bÃ¡o giÃ¡.

### 2.2 Cáº­p nháº­t Data Model

#### Thay Ä‘á»•i trÆ°á»ng `product_notes` trong Project

**Hiá»‡n táº¡i:**
```javascript
product_notes: 'Cáº§n 200 bá»™ cá»­a nhÃ´m cao cáº¥p, 150 bá»™ cá»­a kÃ­nh cÆ°á»ng lá»±c. LiÃªn há»‡ nhÃ£n hÃ ng Eurowindow.'
```

**Thay Ä‘á»•i thÃ nh Object vá»›i nhiá»u trÆ°á»ng:**
```javascript
product_info: {
    notes: 'Cáº§n 200 bá»™ cá»­a nhÃ´m cao cáº¥p, 150 bá»™ cá»­a kÃ­nh cÆ°á»ng lá»±c. LiÃªn há»‡ nhÃ£n hÃ ng Eurowindow.',
    quantity: 350,           // Tá»•ng sá»‘ lÆ°á»£ng sáº£n pháº©m
    unit: 'bá»™',              // ÄÆ¡n vá»‹
    quoted_amount: 850000000 // Sá»‘ tiá»n Ä‘Ã£ bÃ¡o giÃ¡ (VNÄ)
}
```

**LÆ°u Ã½:** Cáº§n migration Ä‘á»ƒ chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u cÅ© sang format má»›i.

### 2.3 CÃ¡c thÃ nh pháº§n hiá»ƒn thá»‹

#### A. Tháº» Thá»‘ng KÃª (Stats Cards)
| Tháº» | MÃ´ táº£ | MÃ u sáº¯c |
|-----|-------|---------|
| **Tá»•ng dá»± Ã¡n Ä‘Ã£ lÃ m** | Sá»‘ dá»± Ã¡n Ä‘Æ°á»£c assign lÃ m TÆ° váº¥n | ğŸ”µ Xanh dÆ°Æ¡ng |
| **Tá»•ng sáº£n pháº©m** | Tá»•ng sá»‘ lÆ°á»£ng sáº£n pháº©m trong cÃ¡c dá»± Ã¡n (tá»« `product_info.quantity`) | ğŸŸ  Cam |
| **Tá»•ng tiá»n Ä‘Ã£ bÃ¡o** | Tá»•ng giÃ¡ trá»‹ bÃ¡o giÃ¡ (tá»« `product_info.quoted_amount`) | ğŸŸ¢ Xanh lÃ¡ |

#### B. Biá»ƒu Ä‘á»“ theo Module Consultant

##### B1. Biá»ƒu Ä‘á»“ Cá»™t - Sá»‘ lÆ°á»£ng dá»± Ã¡n Ä‘Ã£ lÃ m theo thÃ¡ng
- **Loáº¡i:** Bar Chart (Vertical)
- **Trá»¥c X:** ThÃ¡ng (MM/YYYY)
- **Trá»¥c Y:** Sá»‘ lÆ°á»£ng dá»± Ã¡n
- **Bá»™ lá»c:** Dropdown chá»n nÄƒm
- **MÃ u sáº¯c:** Gradient tÃ­m

##### B2. Biá»ƒu Ä‘á»“ Cá»™t - Sá»‘ lÆ°á»£ng sáº£n pháº©m theo dá»± Ã¡n
- **Loáº¡i:** Bar Chart (Horizontal)
- **Trá»¥c X:** Sá»‘ lÆ°á»£ng sáº£n pháº©m
- **Trá»¥c Y:** TÃªn dá»± Ã¡n (top 10)
- **Dá»¯ liá»‡u:** Tá»« `product_info.quantity` cá»§a cÃ¡c dá»± Ã¡n TÆ° váº¥n tham gia
- **MÃ u sáº¯c:** Gradient cam

##### B3. Biá»ƒu Ä‘á»“ Cá»™t - Sá»‘ tiá»n Ä‘Ã£ bÃ¡o giÃ¡ theo dá»± Ã¡n
- **Loáº¡i:** Bar Chart (Horizontal)
- **Trá»¥c X:** Sá»‘ tiá»n (VNÄ)
- **Trá»¥c Y:** TÃªn dá»± Ã¡n (top 10)
- **Dá»¯ liá»‡u:** Tá»« `product_info.quoted_amount` cá»§a cÃ¡c dá»± Ã¡n TÆ° váº¥n tham gia
- **MÃ u sáº¯c:** Gradient xanh lÃ¡
- **Format:** Hiá»ƒn thá»‹ theo Ä‘Æ¡n vá»‹ triá»‡u/tá»· VNÄ

#### C. Biá»ƒu Ä‘á»“ Chung (Giá»‘ng Sales)
- C1. Biá»ƒu Ä‘á»“ TrÃ²n - TÃ¬nh tráº¡ng dá»± Ã¡n
- C2. Biá»ƒu Ä‘á»“ Combo (â‰¥3 thÃ¡ng)

---

## ğŸ” PHÃ‚N QUYá»€N CHI TIáº¾T

| Vai trÃ² | BÃ¡o cÃ¡o Sales | BÃ¡o cÃ¡o TÆ° váº¥n | Dá»¯ liá»‡u hiá»ƒn thá»‹ |
|---------|---------------|----------------|------------------|
| **Admin** | âœ… Xem táº¥t cáº£ | âœ… Xem táº¥t cáº£ | Dropdown chá»n nhÃ¢n viÃªn + Xem tá»•ng há»£p |
| **Sales** | âœ… Xem cá»§a mÃ¬nh | âŒ KhÃ´ng tháº¥y | Chá»‰ hiá»ƒn thá»‹ dá»¯ liá»‡u cÃ¡ nhÃ¢n |
| **Consultant** | âŒ KhÃ´ng tháº¥y | âœ… Xem cá»§a mÃ¬nh | Chá»‰ hiá»ƒn thá»‹ dá»¯ liá»‡u cÃ¡ nhÃ¢n |

### Admin View:
- CÃ³ dropdown Ä‘á»ƒ chá»n nhÃ¢n viÃªn cá»¥ thá»ƒ hoáº·c "Táº¥t cáº£"
- Khi chá»n "Táº¥t cáº£": Hiá»ƒn thá»‹ dá»¯ liá»‡u tá»•ng há»£p cá»§a toÃ n bá»™ team
- CÃ³ thÃªm báº£ng so sÃ¡nh hiá»‡u suáº¥t giá»¯a cÃ¡c nhÃ¢n viÃªn (optional)

---

## ğŸ¨ THIáº¾T Káº¾ UI/UX

### Layout trang Report

```
+-----------------------------------------------+
|  ğŸ“Š BÃO CÃO SALES                    [Dropdown: Chá»n Sales - Admin only]
+-----------------------------------------------+
|  [Stats Card 1]  [Stats Card 2]  [Stats Card 3]
+-----------------------------------------------+
|  +-------------------+  +-------------------+
|  | Biá»ƒu Ä‘á»“ dá»± Ã¡n     |  | Biá»ƒu Ä‘á»“ nhÃ  tháº§u  |
|  | theo thÃ¡ng        |  | má»›i theo thÃ¡ng    |
|  +-------------------+  +-------------------+
+-----------------------------------------------+
|  +-------------------+  +-------------------+
|  | Pie Chart         |  | Combo Chart       |
|  | TÃ¬nh tráº¡ng dá»± Ã¡n  |  | (â‰¥3 thÃ¡ng)        |
|  +-------------------+  +-------------------+
+-----------------------------------------------+
```

### Style Guidelines
- **Cards:** Rounded corners, subtle shadow, glassmorphism effect
- **Charts:** Smooth animations, tooltips on hover
- **Colors:** Theo theme hiá»‡n táº¡i cá»§a app
- **Responsive:** Grid layout responsive cho mobile/tablet

---

## ğŸ“‹ TASK BREAKDOWN

### PHASE 1: Chuáº©n bá»‹ Data (Æ¯á»›c lÆ°á»£ng: 2-3 giá»)

#### Task 1.1: Cáº­p nháº­t Data Model
- [ ] Refactor `product_notes` â†’ `product_info` object trong seed.js
- [ ] ThÃªm cÃ¡c trÆ°á»ng: `notes`, `quantity`, `unit`, `quoted_amount`
- [ ] Cáº­p nháº­t DB_VERSION Ä‘á»ƒ trigger migration
- [ ] Test migration dá»¯ liá»‡u cÅ©

#### Task 1.2: Cáº­p nháº­t Form Dá»± Ã¡n
- [ ] Sá»­a form táº¡o/sá»­a dá»± Ã¡n Ä‘á»ƒ há»— trá»£ `product_info`
- [ ] ThÃªm input fields: Sá»‘ lÆ°á»£ng sáº£n pháº©m, ÄÆ¡n vá»‹, Sá»‘ tiá»n bÃ¡o giÃ¡
- [ ] Validation cho cÃ¡c trÆ°á»ng má»›i
- [ ] Backward compatibility vá»›i dá»¯ liá»‡u cÅ©

#### Task 1.3: Cáº­p nháº­t API functions
- [ ] Sá»­a `api.js` Ä‘á»ƒ Ä‘á»c/ghi `product_info`
- [ ] ThÃªm helper functions cho bÃ¡o cÃ¡o

---

### PHASE 2: Module BÃ¡o cÃ¡o Sales (Æ¯á»›c lÆ°á»£ng: 4-5 giá»)

#### Task 2.1: Táº¡o trang Sales Report
- [ ] Táº¡o file `js/pages/report-sales.js`
- [ ] Táº¡o route `/report-sales` trong router.js
- [ ] ThÃªm menu item trong sidebar

#### Task 2.2: Stats Cards
- [ ] Implement card "Tá»•ng nhÃ  tháº§u Ä‘Ã£ gáº·p"
- [ ] Implement card "NhÃ  tháº§u má»›i thÃ¡ng nÃ y"
- [ ] Implement card "Tá»•ng dá»± Ã¡n tham gia"
- [ ] Animation vÃ  styling

#### Task 2.3: Biá»ƒu Ä‘á»“ dá»± Ã¡n theo thÃ¡ng
- [ ] Implement Bar Chart sá»­ dá»¥ng CSS/Canvas/Chart.js
- [ ] Logic tÃ­nh toÃ¡n dá»¯ liá»‡u theo thÃ¡ng
- [ ] Dropdown filter theo nÄƒm
- [ ] Responsive design

#### Task 2.4: Biá»ƒu Ä‘á»“ nhÃ  tháº§u má»›i theo thÃ¡ng
- [ ] Implement Bar Chart
- [ ] Logic xÃ¡c Ä‘á»‹nh nhÃ  tháº§u má»›i
- [ ] Responsive design

#### Task 2.5: Apply phÃ¢n quyá»n
- [ ] Logic kiá»ƒm tra role
- [ ] Filter dá»¯ liá»‡u theo user Ä‘Äƒng nháº­p
- [ ] Dropdown chá»n nhÃ¢n viÃªn cho Admin

---

### PHASE 3: Module BÃ¡o cÃ¡o TÆ° váº¥n (Æ¯á»›c lÆ°á»£ng: 4-5 giá»)

#### Task 3.1: Táº¡o trang Consultant Report
- [ ] Táº¡o file `js/pages/report-consultant.js`
- [ ] Táº¡o route `/report-consultant` trong router.js
- [ ] ThÃªm menu item trong sidebar

#### Task 3.2: Stats Cards
- [ ] Implement card "Tá»•ng dá»± Ã¡n Ä‘Ã£ lÃ m"
- [ ] Implement card "Tá»•ng sáº£n pháº©m"
- [ ] Implement card "Tá»•ng tiá»n Ä‘Ã£ bÃ¡o"
- [ ] Animation vÃ  styling

#### Task 3.3: Biá»ƒu Ä‘á»“ dá»± Ã¡n theo thÃ¡ng
- [ ] Implement Bar Chart
- [ ] Logic tÃ­nh toÃ¡n theo Consultant assigned
- [ ] Dropdown filter theo nÄƒm

#### Task 3.4: Biá»ƒu Ä‘á»“ sá»‘ lÆ°á»£ng sáº£n pháº©m
- [ ] Implement Horizontal Bar Chart
- [ ] Hiá»ƒn thá»‹ top 10 dá»± Ã¡n
- [ ] Responsive design

#### Task 3.5: Biá»ƒu Ä‘á»“ sá»‘ tiá»n bÃ¡o giÃ¡
- [ ] Implement Horizontal Bar Chart
- [ ] Format sá»‘ tiá»n (triá»‡u/tá»· VNÄ)
- [ ] Hiá»ƒn thá»‹ top 10 dá»± Ã¡n

#### Task 3.6: Apply phÃ¢n quyá»n
- [ ] Logic kiá»ƒm tra role
- [ ] Filter dá»¯ liá»‡u theo user
- [ ] Dropdown chá»n nhÃ¢n viÃªn cho Admin

---

### PHASE 4: Biá»ƒu Ä‘á»“ chung (Æ¯á»›c lÆ°á»£ng: 3-4 giá»)

#### Task 4.1: Pie/Donut Chart - TÃ¬nh tráº¡ng dá»± Ã¡n
- [ ] Implement Donut Chart
- [ ] PhÃ¢n bá»• Active/Won/Lost/Cancelled
- [ ] Animation vÃ  tooltips
- [ ] Hiá»ƒn thá»‹ tá»•ng sá»‘ á»Ÿ giá»¯a

#### Task 4.2: Combo Chart (Bar + Line)
- [ ] Implement Combo Chart
- [ ] Logic kiá»ƒm tra â‰¥3 thÃ¡ng dá»¯ liá»‡u
- [ ] áº¨n/hiá»‡n dá»±a trÃªn Ä‘iá»u kiá»‡n
- [ ] Dual Y-axis

---

### PHASE 5: Polish & Testing (Æ¯á»›c lÆ°á»£ng: 2-3 giá»)

#### Task 5.1: CSS & Animations
- [ ] ThÃªm CSS cho cÃ¡c charts
- [ ] Micro-animations
- [ ] Glassmorphism effects
- [ ] Dark mode support

#### Task 5.2: Testing
- [ ] Test vá»›i cÃ¡c vai trÃ² khÃ¡c nhau (Admin/Sales/Consultant)
- [ ] Test responsive trÃªn mobile
- [ ] Test vá»›i dá»¯ liá»‡u rá»—ng (edge cases)
- [ ] Test performance

#### Task 5.3: Documentation
- [ ] Cáº­p nháº­t CUSTOMER_PRESENTATION_SPEC.md
- [ ] ThÃªm hÆ°á»›ng dáº«n sá»­ dá»¥ng

---

## ğŸ“Š Ká»¸ THUáº¬T TRIá»‚N KHAI CHARTS

### Option 1: Vanilla CSS/HTML Charts (Khuyáº¿n nghá»‹)
- KhÃ´ng phá»¥ thuá»™c thÆ° viá»‡n bÃªn ngoÃ i
- Lightweight
- Custom hoÃ n toÃ n
- Sá»­ dá»¥ng CSS Grid + Flexbox + Transforms

### Option 2: Chart.js (CDN)
```html
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
```
- Dá»… implement
- Nhiá»u loáº¡i chart
- Responsive built-in

### Option 3: Canvas API
- Native JavaScript
- Full control
- Performance tá»‘t

**Quyáº¿t Ä‘á»‹nh:** Sá»­ dá»¥ng **Vanilla CSS/HTML** cho simple charts (bars, pie) vÃ  **Chart.js CDN** náº¿u cáº§n combo chart phá»©c táº¡p.

---

## ğŸ”„ BACKWARD COMPATIBILITY

### Migration Strategy cho product_info

```javascript
// Trong api.js - khi Ä‘á»c project
function getProjectProductInfo(project) {
    // Náº¿u dá»¯ liá»‡u cÅ© (string)
    if (typeof project.product_notes === 'string') {
        return {
            notes: project.product_notes,
            quantity: 0,
            unit: '',
            quoted_amount: 0
        };
    }
    // Náº¿u dá»¯ liá»‡u má»›i (object)
    return project.product_info || {
        notes: '',
        quantity: 0,
        unit: '',
        quoted_amount: 0
    };
}
```

---

## âœ… CHECKLIST HOÃ€N THÃ€NH

- [ ] Data model Ä‘Ã£ cáº­p nháº­t
- [ ] Form dá»± Ã¡n Ä‘Ã£ sá»­a
- [ ] Trang Sales Report hoáº¡t Ä‘á»™ng
- [ ] Trang Consultant Report hoáº¡t Ä‘á»™ng
- [ ] PhÃ¢n quyá»n Ä‘Ãºng cho 3 roles
- [ ] Biá»ƒu Ä‘á»“ trÃ²n hiá»ƒn thá»‹ Ä‘Ãºng
- [ ] Biá»ƒu Ä‘á»“ combo hiá»ƒn thá»‹ khi â‰¥3 thÃ¡ng
- [ ] Responsive trÃªn mobile
- [ ] Test vá»›i nhiá»u scenarios

---

*Version 1.0 - Created: 2026-01-15*
